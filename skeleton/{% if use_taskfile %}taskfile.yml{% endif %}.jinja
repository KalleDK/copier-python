version: '3'

tasks:
  test:
    cmds:
      - uv run pytest -v
  sync:
    cmds:
      - uv sync --group test --group stubs
  update:
    cmds:
      - uv sync -U --group test --group stubs
  {%- if use_ruff %}
  lint:
    cmds:
      - uv run ruff check
  format:
    cmds:
      - uv run ruff format{% endif %}
  {%- if use_precommit %}
  precommit:
    cmds:
      - uv run pre-commit run --all-files
  install-precommit:
    cmds:
      - uv run pre-commit install{% endif %}
  {%- if use_bumpversion %}
  bump:
    vars:
      PART: '{% raw %}{{.PART | default "build"}}{% endraw %}'
    cmds:
      - uv run bump-my-version bump {% raw %}{{ .PART }}{% endraw %}
  devrel:
    cmds:
      - git add .
      - if git commit --dry-run --short; then git commit -m "devrel"; else echo nothing changed; fi
      - task: bump
      - git push --follow-tags
  release:
    cmds:
      - task: bump
        vars:
          PART: 'patch'
      - git push --follow-tags{% endif %}
